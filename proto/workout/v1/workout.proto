syntax = "proto3";
option go_package = "./generated";

import "google/api/annotations.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/field_mask.proto";

service ExerciseService {
  rpc GetExercises(GetExercisesRequest) returns (GetExercisesResponse) {
    option (google.api.http) = {
      get: "/v1/exercises"
    };
  }
}

message GetExercisesRequest {
  optional string muscle_group_filter = 1;
  optional string category_filter = 2;
}

message GetExercisesResponse {
  repeated Exercise exercises = 1;
}

message Exercise {
  string id = 1;
  string name = 2;
  string description = 3;
  string muscle_group = 4;
  string category = 5;
}

service WorkoutService {
  //workout API
  rpc CreateWorkout(CreateWorkoutRequest) returns (CreateWorkoutResponse) {
    option (google.api.http) = {
      post: "/v1/workouts"
      body: "workout"
    };
  }
  rpc GetWorkout(GetWorkoutRequest) returns (GetWorkoutResponse) {
    option (google.api.http) = {
      get: "/v1/workouts/{id}"
      response_body: "workout"
    };
  }
  rpc UpdateWorkout(UpdateWorkoutRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      patch: "/v1/workouts/{workout.id}"
      body: "workout"
    };
  }
  rpc ListWorkouts(google.protobuf.Empty) returns (ListWorkoutsResponse) {
    option (google.api.http) = {
      get: "/v1/workouts"
      response_body: "workouts"
    };
  }
  rpc DeleteWorkout(DeleteWorkoutRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      delete: "/v1/workouts/{id}"
    };
  }
  //workout-exercise API
  rpc UpdateWorkoutExercise(UpdateWorkoutExerciseRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      patch: "/v1/workouts/{exercise.workout_id}/workout-exercises/{exercise.workout_exercise_id}"
      body: "exercise" //it will automatically populate field mask paths
    };
  }
}

message CreateWorkoutRequest {
  Workout workout = 1;
}

message CreateWorkoutResponse {
  string id = 1;
}

message GetWorkoutRequest {
  string id = 1;
}

message GetWorkoutResponse {
  Workout workout = 1;
}

message UpdateWorkoutRequest {
  Workout workout = 1;
  google.protobuf.FieldMask update_mask = 2;
}

message ListWorkoutsResponse {
  repeated Workout workouts = 1;
}

message DeleteWorkoutRequest {
  string id = 1;
}

message Workout {
  // Output only.
  string id = 1;
  string name = 2;
  optional string comment = 3;
  repeated WorkoutExercise exercises = 4;
}

message UpdateWorkoutExerciseRequest {
  WorkoutExercise exercise = 1;
  google.protobuf.FieldMask update_mask = 2;
}

message WorkoutExercise {
  // Output only.
  string workout_exercise_id = 1;
  // Output only.
  string workout_id = 2;
  string exercise_id = 3;
  int32 order = 4;
  int32 repetitions = 5;
  int32 sets = 6;
  optional int32 weight = 7;
  optional string comment = 8;
}
